# Weather API

## Особенности

- Получение текущей погоды по координатам.
- Добавление городов (привязка к пользователю) для отслеживания погоды.
- Получение списка отслеживаемых пользователем городов.
- Получение данных о погоде в городе, привязанном к пользователю, на определённое время.
- Регистрация пользователей.

## Требования

- Python 3.9+
- Установленные зависимости из файла `requirements.txt`
- Доступ к базе данных SQLite или другой поддерживаемой базе данных

## Установка и запуск

1. Создайте виртуальное окружение и активируйте его:

   ```bash
   python3 -m venv venv
   source venv/bin/activate # Для Linux/MacOS
   .\venv\Scripts\activate   # Для Windows
   ```

2. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

3. Запустите основной скрипт:

   ```bash
   python3 script.py
   ```

4. Откройте в браузере интерактивную документацию Swagger:

   ```
   http://127.0.0.1:8000/docs
   ```

## Описание эндпоинтов

### **Маршруты для координат (/coords)**

#### `GET /coords/current/`

Получение текущей погоды по координатам.

- **Параметры запроса:**
  - `latitude` (float, required): Широта.
  - `longitude` (float, required): Долгота.

- **Коды ответа:**
  - `200`: Успешный ответ.
  - `422`: Некорректное тело/параметры запроса


### **Маршруты для городов (/cities)**

#### `POST /cities/track/`

Добавление города для отслеживания.

- **Тело запроса:**
  - `city` (object):
    - `name` (string, required): Название города.
    - `latitude` (float, required): Широта.
    - `longitude` (float, required): Долгота.
  - `user_id` (int, required): ID пользователя.
- **Ответ:**
  - `success` (bool): Успех операции.
  - `id` (int): ID нового города (если добавлено).
  - `message` (string): Сообщение об ошибке (если не добавлено).
- **Коды ответа:**
  - `200`: Город успешно добавлен.
  - `400`: Город не добавлен.
  - `403`: Пользователь не найден.
  - `422`: Некорректное тело/параметры запроса
  - `503`: Ошибка сервиса.

#### `GET /cities/tracked/`

Получение списка отслеживаемых городов.

- **Параметры запроса:**
  - `user_id` (int, required): ID пользователя.
- **Ответ:**
  - Список объектов `city`:
    - `name` (string): Название города.
    - `coords` (object): Координаты города (широта, долгота).
- **Коды ответа:**
  - `200`: Успешный ответ.
  - `422`: Некорректное тело/параметры запроса
  - `503`: Ошибка сервиса.

#### `GET /cities/by-time/`

Получение погоды для города на определённое время.

- **Параметры запроса:**
  - `city_name` (string, required): Название города.
  - `weather_params` (list[string], optional): Список параметров погоды (`temperature`, `relative_humidity`, `surface_pressure`, `precipitation`, `wind_speed`).
  - `time` (time, optional): Время прогноза. По умолчанию текущее.
  - `user_id` (int, required): ID пользователя.
- **Ответ:**
  - Объект с выбранными параметрами погоды.
- **Коды ответа:**
  - `200`: Успешный ответ.
  - `404`: Город не найден.
  - `422`: Некорректное тело/параметры запроса
  - `503`: Ошибка сервиса.

### **Маршруты для пользователей (/user)**

#### `POST /user/reg/`

Регистрация нового пользователя.

- **Тело запроса:**
  - `login` (string, required): Логин пользователя.
- **Ответ:**
  - `success` (bool): Успех операции.
  - `id` (int): ID нового пользователя (если добавлено).
  - `message` (string): Сообщение
- **Коды ответа:**
  - `200`: Пользователь успешно зарегистрирован.
  - `403`: Пользователь уже существует.
  - `422`: Некорректное тело/параметры запроса
  - `503`: Ошибка сервиса.


## Тесты
Для запуска тестов необходимо использовать команду

```bash
pytest script.py
```

